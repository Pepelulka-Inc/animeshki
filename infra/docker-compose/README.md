# Заметки

## Что в этой папке?

Здесь хранятся docker-compose файлы для сборки приложения.
Всё разделено по отдельным сервисам и может запускаться отдельно
друг от друга (почти, у некоторых compose файлов есть зависимость
от других файлов).

## Зачем это?

Чтобы можно было запускать только то, что нужно из сервисов,
а не все сразу, для удобства разработки. Плюс чтобы вручную
каждый раз не менять файлы, чтобы прокинуть порты для дебага -
конфигурации для прокидывания портов для дебага находятся
в отдельных файлах, которые можно легко включать в сборку.

## Как мне это использовать?

Здесь лежит скрипт compose.py, который упрощает всю эту тему с поднятием
docker-compose:

Пользоваться скриптом довольно просто. Вот основные сценарии работы:

`python compose.py list` - выведет табличку, где будут перечислены все сервисы и их зависимости

`python compose.py up-all` - поднять все сервисы

`python compose.py up [список сервисов]` - поднять какие то определенные сервисы

`python compose.py build-all` - собрать образы для всех сервисов

`python compose.py build [список сервисов]` - собрать образы для определенных сервисов

`python compose.py down-all` - удалить все сервисы и их контейнеры

Так же, когда выполняется команда `up` или `up-all` можно указать
флаг `-d`/`--debug`, для того, чтобы применить дебаг настройки докер компоуза.
Эти настройки прописаны в файлах в директории debug. Сейчас там просто проброс портов, для удобного дебага
Порты кстати, не менять! Чтобы не путаться, будем использовать в дебаге одни и те же порты.

Так же можно указать флаг `-D`/`--detach` чтобы отделить процесс
docker-compose от текущего терминала.

## Как мне добавить свой сервис?

1. Для начала нужно написать два докер компоуз файла:

- services/compose.<имя сервиса>.yml 
- debug/compose.debug.<имя сервиса>.yml

2. В скрипт compose.py нужно добавить свой сервис в
список `SERVICES` в начале файла.
Указываем любое `short_name`, `compose_name` указываем то, которое
использовали в названии докер-компоуз файлов. Прописываем
также зависимости от других сервисов.

3. Готово!
